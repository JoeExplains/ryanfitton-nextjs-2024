---
layout: PostLayout
title: 'How to install Home Assistant within an LXC container'
authors: ['Ryan Fitton']
date: '2020-04-01'
tags: ['Development', 'Code Snippets']
draft: false
summary: 'I have published this blog post to help anyone having issues installing Home Assistant (and Docker) in an LXC container running on Ubuntu. When I was installing Home Assistant on my own hardware, I could not find any straight-forward guides detailing how to do this, and Home Assistant&amp;#8217;s own documentation does not help with installing [&amp;hellip;]'
---

<p>
  I have published this blog post to help anyone having issues installing Home Assistant (and
  Docker) in an LXC container running on Ubuntu.
</p>
<p>
  When I was installing Home Assistant on my own hardware, I could not find any straight-forward
  guides detailing how to do this, and Home Assistant&#8217;s own documentation does not help with
  installing in an LXC container.
</p>
<p>
  <strong>NOTE:</strong> As of 18/06/2020 This install method now uses the &#8216;
  <a href="https://github.com/home-assistant/supervised-installer">Supervised installer</a>&#8216;.
  Discussion regarding deprecation on this method is continuing on{' '}
  <a href="https://github.com/home-assistant/supervised-installer">GitHub</a> and Home
  Assistant&#8217;s{' '}
  <a href="https://www.home-assistant.io/blog/2020/05/09/deprecating-home-assistant-supervised-on-generic-linux/">
    website
  </a>
  .
</p>
<p>&nbsp;</p>
<h3>Step 1 &#8211; Create your LXC container</h3>
<p>
  If you have not already done so, create a LXC container in the same way you normally do, if you
  already have done this, skip to Step 2.
</p>
<p>
  In this example my container storage is run on ZFS. You must ensure you have at least 36GB of
  storage space available.
</p>
<p>
  Following these instructions, replace `lxd-homeassistant` with your own container name if you
  wish.
</p>
<p>
  <strong>Create a new container:</strong>
</p>
``` sudo lxc launch ubuntu:18.04 lxd-homeassistant ```
<p>You can set CPU and Memory limits using the following commands:</p>
<p>
  <strong>For CPU:</strong>
</p>
``` sudo lxc config set lxd-homeassistant limits.cpu 1 ```
<p>
  <strong>For Memory:</strong>
</p>
``` sudo lxc config set lxd-homeassistant limits.memory 1024MB ```
<p>
  You can also set Hard Drive size limits with ZFS. To limit the hard drive space of a container.
</p>
<p>
  Note: &#8216;zfs&#8217; is the ZFS name and &#8216;zpool&#8217; and &#8216;containers&#8217; are
  the pool names, the path can be found
  <br />
  using: `sudo zfs list`
</p>
``` sudo zfs set quota=36G zfs/zpool/containers/lxd-homeassistant ```
<p>&nbsp;</p>
<h3>Step 2 &#8211; Give your container specific privileges</h3>
<p>Setup container privileges:</p>
``` sudo lxc config set lxd-homeassistant security.nesting true ```
<p>Now run each of these lines separately:</p>
``` cat &lt;&lt;EOT | sudo - lxc config set lxd-homeassistant raw.lxc lxc.cgroup.devices.allow = a
lxc.cap.drop = EOT ```
<p>Now restart the container:</p>
``` sudo lxc restart lxd-homeassistant ```
<p>&nbsp;</p>
<h3>Step 3 &#8211; Install required packages for Home Assistant</h3>
<p>Within your container, run these commands:</p>
<p>Update your packages:</p>
``` sudo apt-get update ```
<p>Install required packages:</p>
``` sudo apt-get install bash jq curl avahi-daemon dbus software-properties-common apparmor-utils
libnss-mdns mdns-scan ```
<p>&nbsp;</p>
<h3>Step 4 &#8211; Update and reboot the LXC container</h3>
<p>Still within the container, follow the step below:</p>
<p>
  There is a known issue which can affect install Home Assistant. An upgrade and reboot should fix
  the issue:{' '}
  <a href="https://community.home-assistant.io/t/hassio-installation-issue-preparing-hass-io-this-can-take-up-to-20-minutes/30410/35">
    https://community.home-assistant.io/t/hassio-installation-issue-preparing-hass-io-this-can-take-up-to-20-minutes/30410/35
  </a>
  :
</p>
``` sudo apt update &amp;&amp; sudo apt dist-upgrade ```
<p>&nbsp;</p>
<h3>Step 5 &#8211; Run the Home Assistant script</h3>
<p>Still within the container:</p>
<p>
  Run the install script: (This is the updated method using a &#8216;Supervised&#8217; install as of
  18/06/2020)
</p>
``` curl -sL
https://raw.githubusercontent.com/home-assistant/supervised-installer/master/installer.sh | bash -s
-- -m qemux86-64 ```
<p>
  The installation will take up to 20 minutes depending on how fast your Internet connection is.
</p>
<p>Alternatively, the old method may still work, or may not:</p>
``` curl -sL
"https://raw.githubusercontent.com/home-assistant/hassio-installer/master/hassio_install.sh" | sudo
bash -s -- -m qemux86-64 ```
<p>
  Once Home Assistant is installed, you can access the setup via: http://YOUR-LXC-CONTAINER-IP:8123/
  &#8211; Replace `YOUR-LXC-CONTAINER-IP` with your own LXC container&#8217;s IP Address.
</p>
