---
layout: PostLayout
title: Using the Digital Ocean API for Dynamic DNS
authors: ['Ryan Fitton']
date: '2016-12-08'
tags: ['Development', 'Code Snippets']
draft: false
summary: 'A brief tutorial of how to use Digital Ocean&#039;s V2 API as a free Dynamic DNS service. Use a sub-domain to provide a static point for connecting into your home or business.'
---

<p>Digital Ocean&#8217;s <a href="https://developers.digitalocean.com/">v2 API</a> has some great features, and it&#8217;s super easy to use.</p>
<p>Some background information on why I decided to post this: At home I have some IP cameras and servers that I need to access remotely on a daily basis, and as my home internet connection is delivered using a dynamic IP; I knew I had to either purchase a static IP from my provider or use a &#8216;Dynamic DNS&#8217; service.</p>
<p>This is where Digital Ocean&#8217;s API comes in: The API gives you the ability to dynamically update a given sub-domain&#8217;s A record with your home Internet connection&#8217;s IP address. This means I have a free way to always ensure I have a static sub-domain and that I won&#8217;t have to pay extra in order to have a static IP address from my Internet service provider.</p>
<p>The easiest way to get this up-and-running is to run the API commands as a <a href="https://www.digitalocean.com/community/tutorials/how-to-use-cron-to-automate-tasks-on-a-vps">Cron job</a>. In my case I&#8217;ve setup a Cron job which is run every hour.</p>
<p>In the steps below I have provided some example code snippets and Bash script. This has been tested this on Ubuntu 16.04 LTS 64-Bit and no issues have have been seen.</p>
<ol>
<li>Ensure you have a domain already setup within Digital Ocean and your name servers match what Digital Ocean has supplied. More info about this can be found on their community tutorials <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-host-name-with-digitalocean">here</a>.</li>
<li>Setup the sub-domain you wish to act as your home Internet address (such as <strong>homenetwork.exampledomain.co.uk</strong>) within the &#8216;Networking&#8217; area of your Digital Ocean control panel.</li>
<li>Generate a new API token within the &#8216;API&#8217; section of the control panel: click <strong>&#8216;API&#8217;</strong> then click the <strong>&#8216;Generate New Token&#8217;</strong> button. Give your token a name (this can be anything) and ensure Read and Write scopes are selected. Make a note of your token key, this will be used next.</li>
<li>You will now need to find the record ID of the sub-domain which you have just created. You can do this by running this code in your terminal, replace <strong>EXAMPLEDOMAIN.CO.UK</strong> with your domain, not the sub-domain:
<pre class="language-markup"><code class="language-markup">curl -X GET -H "Content-Type: application/json" -H "Authorization: Bearer YOURAPIKEYHERE" "https://api.digitalocean.com/v2/domains/EXAMPLEDOMAIN.CO.UK/records"</code></pre>
<p>If you&#8217;d like the output to be easier to read use this command:</p>
<pre class="language-markup"><code class="language-markup">curl -X GET -H "Content-Type: application/json" -H "Authorization: Bearer YOURAPIKEYHERE" "https://api.digitalocean.com/v2/domains/EXAMPLEDOMAIN.CO.UK/records" | python -m json.tool</code></pre>
</li>
<li>Find the sub-domain and it&#8217;s ID, the result should look similar to this:
<pre class="language-json"><code class="language-json">'{
"data": "123.456.0.789",
"id": 19247136,
"name": "homenetwork",
"port": null,
"priority": null,
"type": "A",
"weight": null
},'</code></pre>
<p>Make a note of the ID as it will be used later.</li>
<li>Now create a file named <strong>&#8216;public-ip-update.sh&#8217;</strong> somewhere on your server to hold the bash script.Enter this code into the file:
<pre class="language-markup"><code class="language-markup">#!/bin/bash
#Author: Ryan Fitton (ryanfitton.co.uk)
# Version 2.0
# 12/11/2016

#Service to get current public IP
CURRENT_IP="`curl -s http://whatismyip.akamai.com/`" #Get the public IP address of this server

#Digital Ocean API configuration
#This will tell Digital Ocean to update the DNS record for homenetwork.exampledomain.co.uk
#API Token
API_TOKEN=YOURAPIKEYHERE

#Domain and Record ID
DOMAIN_NAME=EXAMPLEDOMAIN.CO.UK
DOMAIN_RECORD_ID=YOURDOMAINRECORDID
DOMAIN_RECORD_VALUE=${CURRENT_IP}

#-----------------No need to edit past this point-----------------
#Update Digital Ocean API
#Update record
curl -X PUT -H "Content-Type: application/json" -H "Authorization: Bearer ${API_TOKEN}" -d '{"data":"'"${DOMAIN_RECORD_VALUE}"'"}' "https://api.digitalocean.com/v2/domains/${DOMAIN_NAME}/records/${DOMAIN_RECORD_ID}"

#Debugging
#View domains
#curl -X GET -H "Content-Type: application/json" -H "Authorization: Bearer ${API_TOKEN}" "https://api.digitalocean.com/v2/domains"

#View domain records
#curl -X GET -H "Content-Type: application/json" -H "Authorization: Bearer ${API_TOKEN}" "https://api.digitalocean.com/v2/domains/${DOMAIN_NAME}/records"

#Page 2
#curl -X GET -H "Content-Type: application/json" -H "Authorization: Bearer ${API_TOKEN}" "https://api.digitalocean.com/v2/domains/${DOMAIN_NAME}/records?page=2"</code></pre>
</li>
<li>Fill in your details where these are mentioned:
<ul>
<li><strong>YOURAPIKEYHERE</strong></li>
<li><strong>EXAMPLEDOMAIN.CO.UK</strong></li>
<li><strong>YOURDOMAINRECORDID</strong></li>
</ul>
</li>
<li>Save this file and exit.</li>
<li>Now setup a Cron job using crontab, enter this command: <strong>&#8216;crontab â€“e&#8217;</strong><br />
And use this code to run the public-ip-update.sh every hour:</p>
<pre class="language-markup"><code class="language-markup">0 * * * * /<strong>PATHTOYOURFILE</strong>/public-ip-update.sh</code></pre>
<p>You can push through an update immediately to test by running:</p>
<pre class="language-markup"><code class="language-markup">'bash /<strong>PATHTOYOURFILE</strong>/public-ip-update.sh'</code></pre>
<p>If it runs successfully you will see an output similar to this:</p>
<pre class="language-json"><code class="language-json">'{"domain_record":{"id":12345678,"type":"A","name":"homenetwork","data":"123.456.0.789","priority":null,"port":null,"weight":null}}'</code></pre>
</li>
</ol>
<p>You should now be able to view any IP address changes in the &#8216;Networking&#8217; area within the Digital Ocean control panel. Once you have confirmed the API is working, you&#8217;ll now be able to to connect to your home network using the sub-domain you have assigned, although remember to open any ports on your router in order to access certain parts of your network.</p>
<p>The code snipptets and Bash script within this tutorial are free for you to use in your own projects. If you come up with any suggestions or improvements, please <a href="/contact/">contact me</a> or post a comment below.</p>
