---
layout: PostLayout
title: How to LazyLoad images in WordPress without using a WP Plugin
authors: ['Ryan Fitton']
date: '2020-03-01'
tags: ['Development', 'Code Snippets']
draft: false
summary: 'This post explains how to use the jQuery Lazy library in a WordPress template. By implementing this library into a template manually will give you greater flexibility in terms of which images can be &amp;#8216;lazy loaded&amp;#8217;. A couple of requirements are necessary before using the jQuery Lazy library: Requires at least jQuery 3.4.1 &amp;#8211; This [&amp;hellip;]'
---

<p>This post explains how to use the <a href="https://github.com/eisbehr-/jquery.lazy/blob/master/jquery.lazy.min.js">jQuery Lazy</a> library in a WordPress template.</p>
<p>By implementing this library into a template manually will give you greater flexibility in terms of which images can be &#8216;lazy loaded&#8217;.</p>
<p>A couple of requirements are necessary before using the jQuery Lazy library:</p>
<ul>
<li>Requires at least jQuery 3.4.1 &#8211; This means the default library used by WordPress will need to be disabled, and version 3.4.1 will need to be loaded.</li>
<li>Image tags to be replaced and custom functions added.</li>
</ul>
<h4>Step 1: Converting your image tags</h4>
<p>Go through your theme and you should have image tags similar to:</p>
<pre class="language-html"><code class="language-html">
&lt;img src=&quot;/assets/img/example-image.png&quot; alt=&quot;Example image alt&quot; class=&quot;example_img_class&quot;&gt;
</code></pre>
<p>Wrap this tag in a custom function, which will add the required Lazy load tags:</p>
<pre class="language-php"><code class="language-php">
&lt;?php echo filter_lazyload_img('&lt;img src=&quot;/assets/img/example-image.png&quot; alt=&quot;Example image alt&quot; class=&quot;example_img_class&quot;&gt;'); ?&gt;
</code></pre>
<p>If you&#8217;re using inline background images such as:</p>
<pre class="language-html"><code class="language-html">
&lt;div class=&quot;bg_image&quot; style=&quot;background-image: url(/assets/img/example-image.png)&quot;&gt;
	&lt;div class=&quot;overlay&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>Also, wrap these in a custom function:</p>
<pre class="language-php"><code class="language-php">
&lt;?php echo filter_lazyload_bg('&lt;div class=&quot;bg_image&quot; style=&quot;background-image: url(/assets/img/example-image.png);&quot;&gt;&lt;div class=&quot;overlay&quot;&gt;&lt;/div&gt;&lt;/div&gt;'); ?&gt;
</code></pre>
<h4>Step 2: Load the jQuery scripts and setup LazyLoad instance</h4>
<p>In your <code class="language-html">functions.php</code> file, add the code shown below. This will load the required jQuery files, the Lazy library and setup a new instance of LazyLoad:</p>
<pre class="language-php"><code class="language-php">
if (!is_admin()) {
	//Remove WordPress default jQuery
	wp_deregister_script( 'jquery' );


	//Register custom jQuery library
	//wp_register_script( 'jquery', get_template_directory_uri() . '/assets/js/libs/jquery.3.4.1.min.js', false, null, false ); 
	wp_register_script( 'jquery', 'https://code.jquery.com/jquery-3.4.1.min.js', false, null, false ); 


	//Enqueue custom jQuery library
	wp_enqueue_script('jquery');


	//Enqueue LazyLoad
	wp_enqueue_script( 'lazyload', get_template_directory_uri() . '/assets/js/plugins/jquery.lazy.min.js', 'jquery', null, true ); //Depends on jQuery


	//Inline LazyLoad script
	/*
		New LazyLoad instance 
		More info: http://jquery.eisbehr.de/lazy/

		Config:
			scrollDirection: 'vertical',
			effect: 'fadeIn',
			effectTime: 200,
			threshold: 0,
			visibleOnly: true,
			onError: function(element) {
				console.log('jQuery LazyLoad error. Cannnot load: ' + element.data('src'));
			}
	*/
	wp_add_inline_script( 'lazyload', &quot;jQuery(function($) {  $('.lazy').Lazy({  scrollDirection: 'vertical', effect: 'fadeIn', effectTime: 200, threshold: 0, visibleOnly: true, onError: function(element) { console.log('jQuery LazyLoad error. Cannnot load: ' + element.data('src')); }  }); });&quot;, 'after' );
}
</code></pre>
<h4>Step 3: Add functions for Image and Background images</h4>
<p>Also, within your <code class="language-html">functions.php</code> add these functions which are used to add the required tags for the Image and Background image tags.</p>
<p>For Images add:</p>
<pre class="language-php"><code class="language-php">
/*
	Image lazyload
	More info: More info: http://jquery.eisbehr.de/lazy/
	==============================================================================
*/
function filter_lazyload_img($content) {
	return preg_replace_callback('/(&lt;\s*img[^&gt;]+)(src\s*=\s*&quot;[^&quot;]+&quot;)([^&gt;]+&gt;)/i', 'preg_lazyload_img', $content);
}
add_filter('the_content', 'filter_lazyload_img');

function preg_lazyload_img($img_match) {
	//Replace the image source with lazy placeholder and add a custom attribute
	$img_replace = $img_match[1] . 'src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=&quot; data-src' . substr($img_match[2], 3) . $img_match[3];

	//Add 'lazy' to the class
	$img_replace = preg_replace('/class\s*=\s*&quot;/i', 'class=&quot;lazy ', $img_replace);

	//Add a no-script tag of the original element
	$img_replace .= '&lt;noscript&gt;' . $img_match[0] . '&lt;/noscript&gt;';
	return $img_replace;
}
</code></pre>
<p>And background images, add: </p>
<pre class="language-php"><code class="language-php">
/*
	Background image lazyload
*/
function filter_lazyload_bg($content) {
	//Find the first '&lt;div style=&quot;&quot;&gt;' element
	//return preg_replace_callback('/(&lt;\s*div[^&gt;]+)(style\s*=\s*&quot;[^&quot;]+&quot;)(&gt;)/i', 'preg_lazyload_bg', $content);
	return preg_replace_callback('/(&lt;\s*[^&gt;]+)(style\s*=\s*&quot;[^&quot;]+&quot;)(&gt;)/i', 'preg_lazyload_bg', $content);
}
add_filter('the_content', 'filter_lazyload_bg');

function preg_lazyload_bg($div_match) {
	//Replace the div bg image source with lazy placeholder and add a custom attribute
	//Remove white space from style tag, remove &quot;'&quot;, remove 28 characters (style=&quot;background-image: url() and remove ');&quot;'
	$div_replace = $div_match[1] . 'data-src=&quot;' . str_replace(');&quot;', '',  substr(  str_replace(&quot;'&quot;, '',  str_replace(' ', '', $div_match[2])  ),  28)  ) . '&quot;' . $div_match[3];

	//Add 'lazy' to the class
	$div_replace = preg_replace('/class\s*=\s*&quot;/i', 'class=&quot;lazy ', $div_replace);

	//Add a no-script tag of the original element
	//$div_replace .= '&lt;/div&gt;&lt;noscript&gt;' . $div_match[0] . '&lt;/noscript&gt;';

	return $div_replace;
}
</code></pre>